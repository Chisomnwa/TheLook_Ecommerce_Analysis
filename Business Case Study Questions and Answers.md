## <p align="center"> Business Questions

The purpose of this analysis is to understand and answer some business questions, gain insights and provide some recommendation to increase revenue.

In this analysis, we will be focusing on orders that were not ***cancelled*** or ***returned*** since we will be dealing with metrics related to revenue.

And this analysis was carried out as of September, 6th 2023.

---


### 1. How much are we selling monthly? Is it high or low compared to last month?

### Steps:
  
* Use EXTRACT function to get the unique month numbers.

* Get the revenue by multiplying the sale price with the number of items sold.

* Use the DISTINCT function to get the unique orders placed and the user ids who made a purchase.

```sql
SELECT
  EXTRACT(MONTH FROM oi.Created_at) AS months,
  --DATE_TRUNC(DATE(oi.Created_at), MONTH) AS order_date,
  ROUND(SUM(oi.sale_price * o.num_of_item), 2) AS revenue,
  COUNT(DISTINCT oi.order_id) AS order_count,
  COUNT(DISTINCT oi.user_id) AS customers_purchased
FROM bigquery-public-data.thelook_ecommerce.order_items oi
INNER JOIN `bigquery-public-data.thelook_ecommerce.orders` AS o 
ON oi.order_id = o.order_id
WHERE oi.status NOT IN ('Cancelled', 'Returned')
GROUP BY months
ORDER BY revenue DESC;
```

### Output:
months | revenue | order_count | customers_purchased
-- | -- | -- | --
8 | 2024225.98 | 12925 | 11838
7 | 1730887.66 | 10690 | 10048
9 | 1465431.58 | 8711 | 7793
6 | 1434075.1 | 9161 | 8754
5 | 1417477.58 | 8699 | 8347
4 | 1305888.76 | 7846 | 7553
3 | 1187877.65 | 7408 | 7142
12 | 1028928.7 | 6155 | 5995
1 | 1014080.3 | 6494 | 6275
2 | 986666.35 | 6246 | 6059
10 | 895719.13 | 5525 | 5377
11 | 881674.83 | 5599 | 5440

### Insights
* Revenue has increased steadily

* Total orders and the total number of customers also increased.

* The total number of customers for each month was greater than the total number of orders placed. This means that customers were placing more than one order at a time.
  
 ---
###  2. Who are our customers? Which country do we have major customers coming from? Which Gender and Age group brought in the most profit?

### a. Customers by Country

### Steps:
* Use a CTE to get the distinct user id, country, and the total number of users or customers who were male or female.

* From the CTE, SELECT the country, count of distinct customer ids, and count of customers who were male or female.
	
```sql
WITH customers AS (
  SELECT
    DISTINCT oi.user_id,
    SUM(CASE WHEN u.gender = 'M' THEN 1 ELSE null END) AS male,
    SUM(CASE WHEN u.gender = 'F' THEN 1 ELSE null END) AS female,
    u.country AS country
    FROM bigquery-public-data.thelook_ecommerce.order_items AS oi
    INNER JOIN bigquery-public-data.thelook_ecommerce.users AS u
    ON oi.user_id = u.id
    WHERE oi.status not in ('Cancelled', 'Returned')
    GROUP BY user_id, country
    )

SELECT
  country,
  COUNT(DISTINCT user_id) AS customers_count,
  COUNT(female) AS female,
  COUNT(male) AS male
FROM customers
GROUP BY country
ORDER BY customers_count DESC;
```

### Output:
country| customers_count| female | male
-- | -- | -- | --
China | 22406 | 11064 | 11342
United States | 14908 | 7488 | 7420
Brasil | 9569 | 4922 | 4647
South Korea | 3521 | 1793 | 1728
France | 3077 | 1548 | 1529
United Kingdom | 3043 | 1561 | 1482
Germany | 2801 | 1433 | 1368
Spain | 2681 | 1351 | 1330
Japan | 1620 | 792 | 828
Australia | 1431 | 751 | 680
Belgium | 831 | 424 | 407
Poland | 145 | 63 | 82
Colombia | 11 | 3 | 8
Austria | 3 | 1 | 2
Espana | 1 | 0 | 1

### Insights
* The majority of our customers come from China, the United States, and Brasil.

* The proportion of revenue generated by each gender is almost the same in each country.

### b. Customers by Gender

### Steps:
* Select the gender, and calulate the sum of revenue and total quantity of orders placed by each gender.

```sql
SELECT 
  o.gender,
  ROUND(SUM(oi.sale_price * o.num_of_item), 2) AS revenue,
  SUM(o.num_of_item) AS quantity
FROM bigquery-public-data.thelook_ecommerce.order_items AS oi
INNER JOIN bigquery-public-data.thelook_ecommerce.orders AS o
ON oi.user_id = o.user_id
WHERE oi.status NOT IN ('Cancelled', 'Returned')
GROUP BY gender
ORDER BY revenue DESC;
```

### Output:
gender| revenue | quantity
-- | -- | --
M | 14616268.09 | 232400
F | 12774082.43 | 227701

### Insight
* Male customers generated more revenue and bought more products in quantity than female customers.

### c. Customers by Age Group

### Steps:
* Use the conitional expression by using the case statement to group the customers into different age groups.

* Count the distinct number of customers in each of the age groups.

```sql
SELECT
  CASE
    WHEN u.age < 12 THEN 'Kids'
    WHEN u.age BETWEEN 12 AND 20 THEN 'Teenagers'
    WHEN u.age BETWEEN 20 AND 30 THEN 'Young Adults'
    WHEN u.age BETWEEN 30 AND 50 THEN 'Adults'
    WHEN u.age > 50 THEN 'Elderly'
    END AS age_group,
  COUNT(DISTINCT oi.user_id) AS total_customer
FROM bigquery-public-data.thelook_ecommerce.order_items AS oi
INNER JOIN bigquery-public-data.thelook_ecommerce.users AS u
ON oi.user_id = u.id
GROUP BY age_group
ORDER BY total_customer DESC;
```

### Output:
age_group | total_customer |
-- | -- |
Elderly | 27112
Adults | 27024
Young Adults | 13422
Teenagers | 12210

### Insights:
* We do not have customers who are kids.

* There is a relatively low number of customers in the Young adult and teenage groups.

---
### 3. What brands and product category are we selling more and the least? What are we making money on?

### a. brand sales

### Steps:

* Select the brand, and calculate the sum of the revenue and quantity of products generated by each brand.

```sql
SELECT 
  p.brand AS brand,
  ROUND(SUM(sale_price * num_of_item), 2) AS revenue,
  SUM(num_of_item) AS quantity
FROM bigquery-public-data.thelook_ecommerce.order_items oi
INNER JOIN bigquery-public-data.thelook_ecommerce.orders o
ON oi.order_id = o.order_id
INNER JOIN bigquery-public-data.thelook_ecommerce.products p
ON oi.product_id = p.id
WHERE oi.status NOT IN ('Cancelled', 'Returned')
GROUP BY brand
ORDER BY revenue DESC;
```
## Output:
***We have 2749 brands and below are the results for 5 most profitable brands***

brand| revenue | quantity
-- | -- | --
Diesel | 278436.79 | 2037
Calvin Klein | 287306.22 | 4546
Carhartt | 268143.65 | 33760
True Religion | 2271150.2 | 1358
7 For All Mankind | 2266017.52 | 1694

***Below are also the results for 5 least profitable brands***

brand| revenue | quantity
-- | -- | --
Marshal | 0.14 | 7
Made in USA | 1.96 | 4
Extenders | 5.29 | 1
Eros | 7.99 | 1
Wayfayrer| 9.95 | 1

### Insights
* Diesel brought in the most revenue.

* Allegra K had the most sold quantity, double the amount sold by Calvin Klein.

* Marshal Brand brought in the least revenue.

* We have a lot of brands that sell only 1, 2, or 3 product quantities.

### b. product category sales

### Steps:

* Select the product category, and calculate the sum of the revenue and quantity of products generated by each brand.

```sql
SELECT
  category AS product_category,
  ROUND(SUM(sale_price * num_of_item), 2) AS revenue,
  SUM(num_of_item) AS quantity
FROM bigquery-public-data.thelook_ecommerce.order_items oi
INNER JOIN bigquery-public-data.thelook_ecommerce.orders o
ON oi.order_id = o.order_id
INNER JOIN bigquery-public-data.thelook_ecommerce.products p
ON oi.product_id = p.id
WHERE oi.status NOT IN ('cancelled', 'Returned')
GROUP BY category
ORDER BY revenue DESC;
```

## Output:
***We have 26 product categories and below are the results for 5 most profitable produt categories***

product_category| revenue | quantity
-- | -- | --
Outwear & Coats | 2273650.29 | 15359
Jeans | 2111333.75 | 21419
Sweaters | 1406673.97 | 18632
Fashion Hoodies & Sweatshirts | 1084686.77 | 19995
Swim | 1083734.84 | 19208

***Below are also the results for 5 least profitable product categories***

product_category| revenue | quantity
-- | -- | --
Clothing Sets | 30728.94 | 361
Jumpsuits & Rompers | 68744.86 | 1560
Socks & Hosiery | 107703.36 | 6350
Leggings | 152339.04 | 5335
Skirts | 182690.85 | 3460

### Insights:
* The most profitable product category is Outwear & Coats, followed by Jeans and Sweaters.

* The least profitable product categories are clothing sets Jumpsuits & Rompers.

---
### 4. What are the most cancelled and returned brand and product categories? 

### a. brand cancel and return

###  Steps:

* Select each brand and use conditional aggregation to count the number of rows where the status of the brand is Cancelled or Returned.

```sql
SELECT
  p.brand AS brand,
  SUM(CASE WHEN oi.status = 'Cancelled' THEN 1 ELSE null END) AS Cancelled,
  SUM(CASE WHEN oi.status = 'Returned' THEN 1 ELSE null END) AS Returned
FROM bigquery-public-data.thelook_ecommerce.order_items oi
INNER JOIN bigquery-public-data.thelook_ecommerce.products p
ON oi.product_id = p.id
GROUP BY brand
ORDER BY Cancelled DESC;
--ORDER BY Returned DESC;
```

## Output:
***We have 2756 brands and the most cancelled brands are:***

brand | cancelled | returned
-- | -- | --
Allegra K | 922 | 598
Calvin Klein | 502 | 314
Carhartt | 366 | 271
Nautica | 290 | 187
Hanes | 285 | 180

***And the most returned brands are:***

brand | cancelled | returned
-- | -- | --
Allegra K | 922 | 598
Calvin Klein | 502 | 314
Carhartt | 366 | 271
Nautica | 290 | 187
Volcom| 265 | 181

### Insights:
* The most cancelled brands are also the most returned brands.
* Calvin Klein amd Carhartt which are the second and third most cancelled and returned brands are also two of the most purchased and profitable brands.

### b. Product category cancel and return
```sql
SELECT p.category AS Category,
  SUM(CASE WHEN oi.status = 'Cancelled' THEN 1 ELSE null END) AS Cancelled,
  SUM(CASE WHEN oi.status = 'Returned' THEN 1 ELSE null END) AS Returned
FROM bigquery-public-data.thelook_ecommerce.order_items oi
INNER JOIN bigquery-public-data.thelook_ecommerce.products p
ON oi.product_id = p.id
GROUP BY Category
ORDER by Cancelled DESC
--ORDER by Returned DESC;
```

## Output:
***We have 26 categories and the most cancelled categorie are:***

category | cancelled | returned
-- | -- | --
Intimates | 1982 | 1323
Jeans | 1904| 1245
Tops and Tees | 1831 | 1178
Fashion Hoodies & Sweatshirts | 1763 | 1194
Sleep & Lounge | 1742 | 1125

***And the most returned categories are:***

category | cancelled | returned
-- | -- | --
Intimates | 1982 | 1323
Jeans | 1904 | 1245
Fashion Hoodies & Sweatshirts | 1763 | 1194
Tops and Tees | 1831 | 1178
Sleep & Lounge | 1742 | 1125

### Insights:
* The most cancelled categories are also the most returned categories.
* Jeans and Fashion Hoodies & Sweatshirts which are the second and third most cancelled and returned categoies are also two of the most purchased or profitable categories.

---
### 5. What marketing channel are we doing well on?
```sql
SELECT 
  u.traffic_source AS traffic_source,
  COUNT(DISTINCT oi.user_id) AS total_customers
FROM bigquery-public-data.thelook_ecommerce.order_items oi
INNER JOIN bigquery-public-data.thelook_ecommerce.users u
ON oi.user_id = u.id
WHERE oi.status NOT IN ('Cancelled', 'Returned')
GROUP BY traffic_source
ORDER BY total_customers DESC;
```

## Output:
traffic source| total_customers
-- | --
Search | 45992
Organic | 9872
Facebook | 3842
Email | 3470
Display | 2666

### Insights:
* The chanels that brougth in the most customers were Search, followed by Organic, and Facebook.

---
### 6. We will provide promotions during Chinese New Year celebrations for female customers in China via email.

Please provide data on how many customers we should promote each email!
```sql
SELECT 
  id,
  email
FROM `bigquery-public-data.thelook_ecommerce.users` 
WHERE gender = 'F' AND country = 'China'
ORDER BY id;
```

## Output:
And here the results for the first 5 female customers based in China:

id | email
-- | --
2 | susanscott@example.net
3 | christinageorge@example.net
8 | christinaedwards@example.org
13 | crystalbecker@example.org
18 | monicamiranda@example.com

### Insights:
* TWe have 16,728 female customers who are in China.

---
### 7. Provide a list of 10 customer ids and emails with the largest total overall purchase. We will give a discount for campaign 3.3!

```sql
SELECT
  u.id AS customer_id,
  u.email AS  email,
  ROUND(SUM(oi.sale_price * o.num_of_item), 2) AS total_purchase
FROM bigquery-public-data.thelook_ecommerce.order_items AS oi
INNER JOIN bigquery-public-data.thelook_ecommerce.orders AS o
ON oi.order_id = o.order_id
INNER JOIN bigquery-public-data.thelook_ecommerce.users AS u
ON o.user_id = u.id
GROUP BY customer_id, email
ORDER BY total_purchase DESC
LIMIT 10;
```

## Output:
id | email
-- | --
86558 | matthewwallace@example.org
66300 | jamiehill@example.com
28642 | tylerbaker@example.com
27450 | michaelreese@example.com
1820 | kennethmccullough@example.org
85502 | aaronstevenson@example.net
10434 | keithguzman@example.com
27326 | thomaswallace@example.net
68827| deannadavis@example.net
87500 | alexandraroberts@example.net

---
### 8. Create a query to get frequencies, average order value, and the total number of unique users where status is completed grouped by month (Skillset: Intermediate SQL)

```sql
SELECT 
  FORMAT_DATE("%Y-%m", created_at) AS month_year,
  ROUND((COUNT(DISTINCT order_id)/COUNT(DISTINCT user_id)),2) AS frequencies,
  ROUND((SUM(sale_price)/COUNT(DISTINCT order_id)),2) AS Average_order_value,
  COUNT(DISTINCT user_id) AS total_unique_users
FROM `bigquery-public-data.thelook_ecommerce.order_items`
WHERE status = 'Complete'
GROUP BY month_year
ORDER BY month_year DESC;
```

## Output:

And here are the results for the firs 5 rows:

month_year | frequencies | AOV | total_unique_users
-- | -- | -- | --
2023-09 | 1.1 | 86.13 | 1317
2023-08 | 1.04 | 82.23 | 2452
2023-07 | 1.03 | 85.18 | 1963
2023-06 | 1.01 | 83.92 | 1632
2023-05 | 1.01 | 83.95 | 1562
2023-04 | 1.01 | 80.92 | 1350
2023-03 | 1.01 | 86.18 | 1246
2023-02 | 1.01 | 86.13 | 1120
2023-01 | 1.0 | 82.23 | 1121
2022-12 | 1.01 | 85.18 | 1051

